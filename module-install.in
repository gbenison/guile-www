#!/bin/sh
# usage: module-install DEST RELFILE ...
# Punify RELFILE and install under dest w/ ".scm" truncated.
# The installed module has Copyright header comments.

prefix="@prefix@"
INSTALL="@INSTALL@"
INSTALL_DATA="@INSTALL_DATA@"
srcdir="@srcdir@"
PUNIFY="@PUNIFY@"
need_optargs_kludge="@need_optargs_kludge@"
use_shsub="@use_shsub@"

if [ $need_optargs_kludge = yes ] ; then
    filter='s/optargs-kw/optargs/'
else
    filter=''
fi

if [ $use_shsub = no ] ; then
    filter="$filter;s/make-shared-substring/substring/"
fi

dest=$1 ; shift
cd $srcdir
for f in "$@" ; do
    ( echo ';;; Copyright (C) 2007 FSF' ;
      $PUNIFY $f | sed "$filter" ) > TMP
    g=`echo $f | sed 's/[.]scm$//'`
    $INSTALL_DATA TMP $dest/$g
    echo ' 'wrote $dest/$g
done
rm -f TMP
exit 0

# module-install ends here
